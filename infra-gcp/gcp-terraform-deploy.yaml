variables:
- group: Infrastructure-Variables-EPAM-3
steps:
- script: |
   sudo apt-get -y update
   sudo apt-get -y install git

   # Download Terraform
   wget https://releases.hashicorp.com/terraform/0.12.5/terraform_0.12.5_linux_amd64.zip
   sudo unzip -o ./terraform_0.12.5_linux_amd64.zip -d /usr/local/bin/ 

   git clone https://github.com/Xangliev/Devops-epam-app.git
   cd Devops-epam-app/infra-gcp

   # Initalize Terraform with GCP creds
   echo $(SERVICE_ACCOUNT) > CI_PIPELINE_ID.json
   terraform init 
   # Deploy terraform infrastructure
   terraform apply -auto-approve